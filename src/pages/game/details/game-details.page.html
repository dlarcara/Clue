<ion-header>
    <ion-toolbar>
        <ion-title>Game Replay</ion-title>
        <ion-buttons end>
            <button ion-button icon-only (click)="showFilters = true" *ngIf="!showFilters">
                <ion-icon name="search"></ion-icon>
            </button>
            <button ion-button icon-only (click)="showFilters = false" *ngIf="showFilters">
                <ion-icon name="list-box"></ion-icon>
            </button>            
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content>
    <!-- Filter Display -->
    <div *ngIf="showFilters" padding>
        <div class="filter-header">Genreal</div>
        <div class="filter-group">
            <!-- Passes -->
            <ion-segment [(ngModel)]="filterDoNotShowPasses">
                <ion-segment-button [value]="false">Include Passes</ion-segment-button>
                <ion-segment-button [value]="true">Ignore Passes</ion-segment-button>
            </ion-segment>

            <!-- Turn Types -->
            <ion-segment [(ngModel)]="filterShowOnlyUnresolvedTurns">
                <ion-segment-button [value]="false">All Turns</ion-segment-button>
                <ion-segment-button [value]="true">Unresolved Truns</ion-segment-button>
            </ion-segment>
        </div>

        <!-- Player -->
        <div class="filter-header">Players</div>
        <div class="filter-group">
            <ion-segment [(ngModel)]="filterPlayer" (ngModelChange)="filterPlayer = $event ? $event : null">
                <ion-segment-button value="">Any</ion-segment-button>
                <ion-segment-button *ngFor="let player of gameTracker.players" [value]="player">
                    <player-icon [player]="player"></player-icon>
                </ion-segment-button>
            </ion-segment>
        </div>
    </div>
    
    <!-- Turns Display -->
    <div *ngIf="!showFilters">
        <ion-card *ngIf="!getTurns().length">
            <ion-card-content>
                <p>No turns to display</p>
            </ion-card-content>
        </ion-card>
        
        <ion-card *ngFor="let turn of getTurns()">
            <ion-card-header>
                <div class="item row">
                    <span align="left" class="col col-80">Turn #{{turn.number}}</span>
                    <span align="right" class="col col-20">
                        <player-icon [player]="turn.player"></player-icon>
                    </span>
                </div>
            </ion-card-header>

            <ion-card-content>
                <p *ngIf="!turn.guess"><span class="display-value">{{getPlayerDisplay(turn.player)}}</span> passed.</p>
                <div *ngIf="turn.guess">
                    <p>
                        <span class="display-value">{{getPlayerDisplay(turn.player)}}</span> guessed 
                        <span class="display-value">{{getCardDisplay(CardCategory.SUSPECT, turn.guess.suspect)}}</span> in the 
                        <span class="display-value">{{getCardDisplay(CardCategory.ROOM, turn.guess.room)}}</span> with the
                        <span class="display-value">{{getCardDisplay(CardCategory.WEAPON, turn.guess.weapon)}}</span>.
                        
                        <span *ngIf="!turn.guess.playerThatShowed"><span class="display-value">No one</span> disproved it.</span>
                        <span *ngIf="turn.guess.playerThatShowed">
                            <span *ngIf="!playerIsDetective(turn.player)">
                                <span class="display-value">{{getPlayerDisplay(turn.guess.playerThatShowed)}}</span> disproved it.
                            </span>
                            <span *ngIf="playerIsDetective(turn.player)">
                                <span class="display-value">{{getPlayerDisplay(turn.guess.playerThatShowed)}}</span> disproved it by showing you 
                                <span *ngIf="turn.guess.cardShown.category != CardCategory.SUSPECT">the </span>
                                <span class="display-value">{{getCardDisplay(turn.guess.cardShown.category, turn.guess.cardShown.cardIndex)}}</span>.
                            </span>
                        </span>
                    </p>
                    
                    <!-- Show resolution information about the guess from this turn, if it wasn't your turn or you weren't the one who showed -->
                    <div *ngIf="shouldShowTurnResolution(turn)" class="guess-resolution">
                        <ion-grid>
                            <ion-row>
                                <ion-col></ion-col>
                                <ion-col class="sheet-cell-icon" col-auto>
                                    <img [src]="getCardByCategory(turn.guess, CardCategory.SUSPECT).icon" class="game-card-icon"/>
                                </ion-col>
                                <ion-col class="sheet-cell-icon" col-auto>
                                    <ion-icon name="checkmark-circle" color="valid" *ngIf="getStatusForCard(turn.guess, CardCategory.SUSPECT) == CellStatus.HAD"></ion-icon>
                                    <ion-icon name="close-circle" color="invalid" *ngIf="getStatusForCard(turn.guess, CardCategory.SUSPECT) == CellStatus.NOTHAD"></ion-icon>
                                </ion-col>
                                <ion-col></ion-col>
                                <ion-col class="sheet-cell-icon" col-auto>
                                    <img [src]="getCardByCategory(turn.guess, CardCategory.WEAPON).icon" class="game-card-icon"/>
                                </ion-col>
                                <ion-col class="sheet-cell-icon" col-auto>
                                    <ion-icon name="checkmark-circle" color="valid" *ngIf="getStatusForCard(turn.guess, CardCategory.WEAPON) == CellStatus.HAD"></ion-icon>
                                    <ion-icon name="close-circle" color="invalid" *ngIf="getStatusForCard(turn.guess, CardCategory.WEAPON) == CellStatus.NOTHAD"></ion-icon>
                                </ion-col>
                                <ion-col></ion-col>
                                <ion-col class="sheet-cell-icon" col-auto>
                                    <img [src]="getCardByCategory(turn.guess, CardCategory.ROOM).icon" class="game-card-icon"/>
                                </ion-col>
                                <ion-col class="sheet-cell-icon" col-auto>
                                    <ion-icon name="checkmark-circle" color="valid" *ngIf="getStatusForCard(turn.guess, CardCategory.ROOM) == CellStatus.HAD"></ion-icon>
                                    <ion-icon name="close-circle" color="invalid" *ngIf="getStatusForCard(turn.guess, CardCategory.ROOM) == CellStatus.NOTHAD"></ion-icon>
                                </ion-col>
                                <ion-col></ion-col>
                            </ion-row>
                        </ion-grid>
                    </div>
                </div>
                
                <span class="progress-bar" [style.width]="(turn.resultingSheet.getProgress() * 100) + '%'"></span>
            </ion-card-content>
        </ion-card>
    </div>
</ion-content>